/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var q=Object.defineProperty;var G=Object.getOwnPropertyDescriptor;var U=Object.getOwnPropertyNames;var X=Object.prototype.hasOwnProperty;var Y=(l,h)=>{for(var e in h)q(l,e,{get:h[e],enumerable:!0})},J=(l,h,e,t)=>{if(h&&typeof h=="object"||typeof h=="function")for(let s of U(h))!X.call(l,s)&&s!==e&&q(l,s,{get:()=>h[s],enumerable:!(t=G(h,s))||t.enumerable});return l};var Z=l=>J(q({},"__esModule",{value:!0}),l);var b=(l,h,e)=>new Promise((t,s)=>{var n=i=>{try{a(e.next(i))}catch(o){s(o)}},r=i=>{try{a(e.throw(i))}catch(o){s(o)}},a=i=>i.done?t(i.value):Promise.resolve(i.value).then(n,r);a((e=e.apply(l,h)).next())});var se={};Y(se,{default:()=>A});module.exports=Z(se);function S(l,h){let e=Object.keys(h).map(t=>K(l,t,h[t]));return e.length===1?e[0]:function(){e.forEach(t=>t())}}function K(l,h,e){let t=l[h],s=l.hasOwnProperty(h),n=s?t:function(){return Object.getPrototypeOf(l)[h].apply(this,arguments)},r=e(n);return t&&Object.setPrototypeOf(r,t),Object.setPrototypeOf(a,r),l[h]=a,i;function a(...o){return r===n&&l[h]===a&&i(),r.apply(this,o)}function i(){l[h]===a&&(s?l[h]=n:delete l[h]),r!==n&&(r=n,Object.setPrototypeOf(a,t||Function))}}var g=require("obsidian");var I=require("obsidian");var H=class extends I.MarkdownRenderer{constructor(e,t,s){super(e,t);this.app=e,this.match=s,this.subpath="",this.indent="",this.filePath=this.match.parentDom.path,this.file=this.match.parentDom.file,this.renderer.previewEl.onNodeInserted(()=>(this.updateOptions(),this.renderer.onResize()))}updateOptions(){let e=this.app.vault.getConfig("readableLineLength");this.renderer.previewEl.toggleClass("is-readable-line-width",e);let t=this.app.vault.getConfig("foldHeading");this.renderer.previewEl.toggleClass("allow-fold-headings",t);let s=this.app.vault.getConfig("foldIndent");this.renderer.previewEl.toggleClass("allow-fold-lists",s),this.renderer.previewEl.toggleClass("rtl",this.app.vault.getConfig("rightToLeft")),t||this.renderer.unfoldAllHeadings(),s||this.renderer.unfoldAllLists(),this.renderer.previewEl.toggleClass("show-frontmatter",this.app.vault.getConfig("showFrontmatter"));let n=this.app.vault.getConfig("tabSize");this.renderer.previewEl.style.setProperty("--tab-size",`${n}px`),this.renderer.rerender()}onRenderComplete(){}getFile(){return this.match.parent.file}edit(e){return b(this,null,function*(){var o;this.renderer.set(e);let t=yield this.app.vault.cachedRead(this.file),n=(o=t.slice(this.match.start,this.match.end).match(/^\s+/g))==null?void 0:o.first();n&&(e=e.replace(/^/gm,n));let r=t.slice(0,this.match.start),a=t.slice(this.match.end,this.match.parent.content.length),i=r+e+a;yield this.app.vault.modify(this.file,i)})}};var R=require("obsidian");var M=i18next.t.bind(i18next);var $={defaultCollapse:!1,defaultShowContext:!1,defaultHideTitle:!1,defaultHideResults:!1,defaultRenderMarkdown:!1,defaultSortOrder:"alphabetical"},O=[{key:"alphabetical",label:M("plugins.file-explorer.label-sort-a-to-z")},{key:"alphabeticalReverse",label:M("plugins.file-explorer.label-sort-z-to-a")},{key:"byModifiedTime",label:M("plugins.file-explorer.label-sort-new-to-old")},{key:"byModifiedTimeReverse",label:M("plugins.file-explorer.label-sort-old-to-new")},{key:"byCreatedTime",label:M("plugins.file-explorer.label-sort-created-new-to-old")},{key:"byCreatedTimeReverse",label:M("plugins.file-explorer.label-sort-created-old-to-new")}],ee=l=>l.reduce((h,e)=>(h[e.key]=e.label,h),{}),L=class extends R.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t}hide(){}display(){let{containerEl:e}=this;e.empty(),new R.Setting(e).setName("Collapse query results by default").addToggle(t=>t.setValue(this.plugin.settings.defaultCollapse).onChange(s=>{this.plugin.settings.defaultCollapse=s,this.plugin.saveSettings()})),new R.Setting(e).setName("Show additional query result context by default").addToggle(t=>t.setValue(this.plugin.settings.defaultShowContext).onChange(s=>{this.plugin.settings.defaultShowContext=s,this.plugin.saveSettings()})),new R.Setting(e).setName("Hide query title by default").addToggle(t=>t.setValue(this.plugin.settings.defaultHideTitle).onChange(s=>{this.plugin.settings.defaultHideTitle=s,this.plugin.saveSettings()})),new R.Setting(e).setName("Hide query results by default").addToggle(t=>t.setValue(this.plugin.settings.defaultHideResults).onChange(s=>{this.plugin.settings.defaultHideResults=s,this.plugin.saveSettings()})),new R.Setting(e).setName("Render results as Markdown by default").addToggle(t=>t.setValue(this.plugin.settings.defaultRenderMarkdown).onChange(s=>{this.plugin.settings.defaultRenderMarkdown=s,this.plugin.saveSettings()})),new R.Setting(e).setName("Default query result sort order").addDropdown(t=>{t.addOptions(ee(O)),t.setValue(this.plugin.settings.defaultSortOrder),t.onChange(s=>b(this,null,function*(){this.plugin.settings.defaultSortOrder=s,yield this.plugin.saveSettings()}))})}};var m,T;function F(l,h,e,t,s){if(m){T();return}m=document.createElement("div"),m.classList.add("query-control-sort-tooltip");let n=h.getBoundingClientRect(),r=n.bottom+window.scrollY+5,a=n.left+window.scrollX;m.style.setProperty("--tooltip-top",`${r}px`),m.style.setProperty("--tooltip-left",`${a}px`),l.forEach(p=>{let u=document.createElement("div");if(u.classList.add("query-control-sort-option"),u.textContent=p.label,p.key===t){u.setAttribute("aria-current","true");let y=document.createElement("span");y.textContent="\u2713",y.classList.add("query-control-sort-option-checkmark"),u.appendChild(y)}u.addEventListener("click",()=>{e(p.key),T()}),m.appendChild(u)}),document.body.appendChild(m),T=()=>{document.removeEventListener("mousedown",o,!0),document.removeEventListener("touchstart",o,!0),document.removeEventListener("click",o),document.removeEventListener("keydown",c,!0),s.workspace.off("active-leaf-change",i),m.remove(),m=void 0};let i=()=>{m.parentElement&&(m.remove(),T())},o=p=>{!m.contains(p.target)&&!h.contains(p.target)&&(m.remove(),T())},c=p=>{m.remove(),T()};document.addEventListener("mousedown",o,!0),document.addEventListener("touchstart",o,!0),document.addEventListener("click",o),document.addEventListener("keydown",c,!0),s.workspace.on("active-leaf-change",i)}var z=new WeakMap,A=class extends g.Plugin{onload(){return b(this,null,function*(){yield this.loadSettings();let e=this;this.registerSettingsTab(),this.register(S(this.app.viewRegistry.constructor.prototype,{registerView(s){return function(n,r,...a){return e.app.workspace.trigger("view-registered",n,r),s.call(this,n,r,...a)}}}));let t;if(!this.app.workspace.layoutReady){let s=this.app.workspace.on("view-registered",(r,a)=>{if(r!=="search")return;this.app.workspace.offref(s);let i=new g.WorkspaceLeaf(e.app),o=a(i);e.patchNativeSearch(o);let c=S(g.Modal.prototype,{open(p){return function(...u){e.SearchResultsExport=this.constructor}}});o.onCopyResultsClick(new MouseEvent(null)),c()}),n=this.app.workspace.on("view-registered",(r,a)=>{if(r!=="backlink")return;this.app.workspace.offref(n);let i=new g.WorkspaceLeaf(e.app),o=a(i);e.SearchHeaderDOM=o.backlink.headerDom.constructor})}this.register(t=S(g.Component.prototype,{addChild(s){return function(n,...r){try{if(!e.isSearchPatched&&n instanceof g.Component&&n.hasOwnProperty("searchQuery")&&n.hasOwnProperty("sourcePath")&&n.hasOwnProperty("dom")){let i=n;e.patchSearchView(i),e.isSearchPatched=!0}if(n instanceof g.Component&&n.hasOwnProperty("backlinkDom")){let i=n;z.set(i.backlinkDom.el.closest(".backlink-pane"),n),e.isBacklinksPatched||(e.patchBacklinksView(i),e.isBacklinksPatched=!0)}}catch(i){console.error("Error in Component.addChild around patch:",i)}return s.call(this,n,...r)}}}))})}loadSettings(){return b(this,null,function*(){this.settings=Object.assign({},$,yield this.loadData())})}saveSettings(){return b(this,null,function*(){yield this.saveData(this.settings)})}registerSettingsTab(){this.settingsTab=new L(this.app,this),this.addSettingTab(this.settingsTab)}getSearchHeader(){var s,n,r;let e=(s=this.app.workspace.getLeavesOfType("backlink"))==null?void 0:s.first();e==null||e.loadIfDeferred();let t=(r=(n=e==null?void 0:e.view)==null?void 0:n.backlink)==null?void 0:r.headerDom;return t==null?void 0:t.constructor}onunload(){let e="Query Control: Please restart Obsidian to complete plugin unload.";console.log(e),new g.Notice(e)}patchNativeSearch(e){let t=this;this.register(S(e.constructor.prototype,{onResize(s){return function(...n){var a;let r=(a=this.dom.vChildren)==null?void 0:a._children;return this.dom.el.clientWidth===0?(r.forEach(i=>{i.setCollapse(!0,!1)}),this.dom.hidden=!0):this.dom.hidden&&(this.dom.hidden=!1,setTimeout(()=>{r.forEach(i=>{i.setCollapse(this.dom.collapseAll,!1)})},100)),s.call(this,...n)}},stopSearch(s){return function(...n){let r=s.call(this,...n);return this.renderComponent&&(this.renderComponent.unload(),this.renderComponent=new g.Component),r}},addChild(s){return function(...n){var a;try{if(!this.patched){this.renderComponent||(this.renderComponent=new g.Component,this.renderComponent.load()),this.patched=!0,this.dom.parent=this,t.patchSearchResultDOM(this.dom.constructor),this.setRenderMarkdown=function(o){var p,u;let c=(p=this.dom.vChildren)==null?void 0:p._children;this.dom.renderMarkdown=o,c.forEach(y=>{y.renderContentMatches()}),this.dom.infinityScroll.invalidateAll(),this.dom.childrenEl.toggleClass("cm-preview-code-block",o),this.dom.childrenEl.toggleClass("is-rendered",o),(u=this.renderMarkdownButtonEl)==null||u.toggleClass("is-active",o)},this.renderMarkdownButtonEl=(a=this.headerDom)==null?void 0:a.addNavButton("reading-glasses","Render Markdown",()=>this.setRenderMarkdown(!this.dom.renderMarkdown));let i={renderMarkdown:t.settings.defaultRenderMarkdown};this.settings||(this.settings={}),Object.entries(i).forEach(([o,c])=>{this.settings.hasOwnProperty(o)?o==="sort"&&!O.hasOwnProperty(this.settings.sort)&&(this.settings[o]=c):this.settings[o]=c}),this.setRenderMarkdown(this.settings.renderMarkdown)}}catch(i){console.error("Error in searchView.addChild around patch:",i)}return s.call(this,...n)}}}))}patchSearchResultDOM(e){let t=this,s=S(e.prototype,{addResult(n){return function(...r){s();let a=n.call(this,...r),i=a.constructor;return t.isSearchResultItemPatched||t.patchSearchResultItem(i),a}}});this.register(s),this.register(S(e.prototype,{startLoader(n){return function(...r){var i,o,c,p,u,y;try{let x=this.el.closest(".backlink-pane");if(x){let k=z.get(x);k&&(k.patched||te(this,t,k))}if(!((o=(i=this.parent)==null?void 0:i.searchParamsContainerEl)!=null&&o.patched)&&((p=(c=this.el)==null?void 0:c.parentElement)==null?void 0:p.getAttribute("data-type"))==="search"){if(!this.parent)return;this.parent.searchParamsContainerEl.patched=!0,new g.Setting(this.parent.searchParamsContainerEl).setName("Render Markdown").setClass("mod-toggle").addToggle(k=>{k.setValue(t.settings.defaultRenderMarkdown),k.onChange(v=>{var P;this.renderMarkdown=v,((P=this.vChildren)==null?void 0:P._children).forEach(d=>{d.renderContentMatches()}),this.infinityScroll.invalidateAll(),this.childrenEl.toggleClass("cm-preview-code-block",v),this.childrenEl.toggleClass("is-rendered",v)})})}if(!this.patched&&((u=this.el.parentElement)==null?void 0:u.hasClass("internal-query"))){let k=t.SearchHeaderDOM?t.SearchHeaderDOM:t.getSearchHeader();if(!k){console.error("Error: _SearchHeaderDOM is undefined. Cannot create headerDom.");return}if((y=this.el)!=null&&y.closest(".internal-query")){this.patched=!0;let v=this.el.parentElement.querySelector(".internal-query-header");this.setExtraContext=function(d){var C;let w=(C=this.vChildren)==null?void 0:C._children;this.extraContext=d,this.extraContextButtonEl.toggleClass("is-active",d),w.forEach(f=>{f.setExtraContext(d)}),this.infinityScroll.invalidateAll()},this.setTitleDisplay=function(d){this.showTitle=d,this.showTitleButtonEl.toggleClass("is-active",d),v.toggleClass("is-hidden",d)},this.setResultsDisplay=function(d){this.showResults=d,this.showResultsButtonEl.toggleClass("is-active",d),this.el.toggleClass("is-hidden",d)},this.setRenderMarkdown=function(d){var C;this.renderMarkdown=d,((C=this.vChildren)==null?void 0:C._children).forEach(f=>{f.renderContentMatches()}),this.infinityScroll.invalidateAll(),this.childrenEl.toggleClass("cm-preview-code-block",d),this.childrenEl.toggleClass("is-rendered",d),this.renderMarkdownButtonEl.toggleClass("is-active",d)},this.setCollapseAll=function(d){var C;let w=(C=this.vChildren)==null?void 0:C._children;this.collapseAllButtonEl.toggleClass("is-active",d),this.collapseAll=d,w.forEach(f=>{f.setCollapse(d,!1)}),this.infinityScroll.invalidateAll()},this.setSortOrder=d=>{this.sortOrder=d,this.changed(),this.infinityScroll.invalidateAll()},this.onCopyResultsClick=d=>b(this,null,function*(){var _,B;d.preventDefault();let w=[],C=(_=this.vChildren)==null?void 0:_._children;for(let D of C){let Q=D.file.path,V="",j=(B=D.vChildren)==null?void 0:B._children;for(let N of j){let W=N.parent.content.substring(N.start,N.end);V+=W+`
`}w.push(`## ${Q}
${V}`)}let f=w.join(`
`);try{yield navigator.clipboard.writeText(f),new g.Notice("Search results copied to clipboard.")}catch(D){console.error("Failed to copy search results:",D),new g.Notice("Failed to copy search results.")}});let E=this.headerDom=new k(this.app,this.el.parentElement);v.insertAdjacentElement("afterend",E.navHeaderEl),this.collapseAllButtonEl=E.addNavButton("bullet-list",M("plugins.search.label-collapse-results"),d=>(d.stopPropagation(),this.setCollapseAll(!this.collapseAll))),this.extraContextButtonEl=E.addNavButton("expand-vertically",M("plugins.search.label-more-context"),d=>(d.stopPropagation(),this.setExtraContext(!this.extraContext))),this.showSortButtonEl=E.addNavButton("arrow-up-narrow-wide","Sort",d=>{d.stopPropagation();let w=O.map(f=>f.key),C=f=>{if(w.includes(f)){this.sortOrder=f;let B=`Sort (${O.find(D=>D.key===f).label})`;this.showSortButtonEl.setAttribute("aria-label",B),this.setSortOrder(f)}else console.error(`Invalid sort option: ${f}`)};F(O,this.showSortButtonEl,C,this.sortOrder,this.app)}),this.showTitleButtonEl=E.addNavButton("strikethrough-glyph","Hide title",d=>(d.stopPropagation(),this.setTitleDisplay(!this.showTitle))),this.showResultsButtonEl=E.addNavButton("minus-with-circle","Hide results",d=>(d.stopPropagation(),this.setResultsDisplay(!this.showResults))),this.renderMarkdownButtonEl=E.addNavButton("reading-glasses","Render Markdown",d=>(d.stopPropagation(),this.setRenderMarkdown(!this.renderMarkdown))),E.addNavButton("documents","Copy results",this.onCopyResultsClick.bind(this));let P={title:t.settings.defaultHideResults,collapsed:t.settings.defaultCollapse,context:t.settings.defaultShowContext,hideTitle:t.settings.defaultHideTitle,hideResults:t.settings.defaultHideResults,renderMarkdown:t.settings.defaultRenderMarkdown,sort:t.settings.defaultSortOrder};this.settings||(this.settings={}),Object.entries(P).forEach(([d,w])=>{this.settings.hasOwnProperty(d)?d==="sort"&&!O.hasOwnProperty(this.settings.sort)&&(this.settings[d]=w):this.settings[d]=w}),this.setExtraContext(this.settings.context),this.sortOrder=this.settings.sort,this.setCollapseAll(this.settings.collapsed),this.setTitleDisplay(this.settings.hideTitle),this.setRenderMarkdown(this.settings.renderMarkdown),this.setResultsDisplay(this.settings.hideResults)}}}catch(x){console.error("Error in SearchResultDOM.startLoader around patch:",x)}return n.call(this,...r)}}}))}patchSearchResultItem(e){this.isSearchResultItemPatched=!0;let t=this,s=S(e.prototype,{onResultClick(n){return function(r,a,...i){if(!(r.target instanceof HTMLElement&&(r.target.hasClass("internal-link")||r.target.hasClass("task-list-item-checkbox")||r.target.hasClass("admonition-title-content"))))return n.call(this,r,a,...i)}},renderContentMatches(n){return function(...r){var o;let a=n.call(this,...r),i=(o=this.vChildren)==null?void 0:o._children;if(!t.isSearchResultItemMatchPatched&&i.length){let c=i.first().constructor;t.patchSearchResultItemMatch(c)}return a}}});t.register(s)}patchSearchResultItemMatch(e){this.isSearchResultItemMatchPatched=!0;let t=this;t.register(S(e.prototype,{render(s){return function(...n){var c;let r=this.parentDom,a=r.content.substring(this.start,this.end).replace("```query","\\`\\`\\`query"),i=(c=a.match(/^\s+/g))==null?void 0:c.first();i&&(a=a.replace(new RegExp(`^${i}`,"gm"),""));let o=r.parent.parent;if(o&&r.parent.renderMarkdown){let p=o==null?void 0:o.renderComponent;this.el.empty();let u=new H(t.app,this.el,this);u.onRenderComplete=()=>{var y;(y=r==null?void 0:r.parent)==null||y.infinityScroll.measure(r,this)},p.addChild(u),u.renderer.set(a)}else return s.call(this,...n)}}}))}patchSearchView(e){let t=e.constructor,s=e.dom.constructor;this.register(S(t.prototype,{onunload(n){return function(...r){return this.renderComponent&&(this.renderComponent.unload(),this.dom=null,this.queue=null,this.renderComponent=null,this._children=null,this.containerEl=null),n.call(this,...r)}},onload(n){return function(...r){try{this.renderComponent||(this.renderComponent=new g.Component,this.renderComponent.load()),this.dom.parent=this;let i=this.containerEl.parentElement.querySelector(".internal-query-header"),o=this.query.matchAll(new RegExp("^(?<key>collapsed|context|hideTitle|renderMarkdown|hideResults|sort|title):\\s*(?<value>.+?)$","gm")),c={};for(let p of o){let u=p.groups.value.toLowerCase();(u==="true"||u==="false")&&(p.groups.value=u==="true"),c[p.groups.key]=p.groups.value}this.query=this.query.replace(/^((collapsed|context|hideTitle|renderMarkdown|hideResults|sort|title):.+?)$/gm,"").trim(),i.setText(c.title||this.query),this.dom.settings=c}catch(i){console.error("Error in EmbeddedSearch.onload:",i)}return n.call(this,...r)}}})),this.patchSearchResultDOM(s)}patchBacklinksView(e){let t=e.constructor,s=e.backlinkDom.constructor;this.register(S(t.prototype,{onunload(n){return function(...r){return this.renderComponent&&(this.renderComponent.unload(),this.dom=null,this.queue=null,this.renderComponent=null,this._children=null,this.containerEl=null),n.call(this,...r)}},onload(n){return function(...r){try{this.renderComponent||(this.renderComponent=new g.Component,this.renderComponent.load()),this.dom||(console.warn("Backlink `dom` is undefined. Initializing default properties."),this.dom={}),this.backlinkDom.parent=this,this.unlinkedDom.parent=this,this.dom.settings=this.dom.settings||{}}catch(a){console.error("Error in Backlink.onload:",a)}return n.call(this,...r)}}})),this.patchSearchResultDOM(s)}};function te(l,h,e){if(e){e.patched=!0,l.setRenderMarkdown=function(s){[e.backlinkDom,e.unlinkedDom].forEach(r=>{var i;r.renderMarkdown=s,((i=r.vChildren)==null?void 0:i._children).forEach(o=>{o.renderContentMatches()}),r.infinityScroll.invalidateAll(),r.childrenEl.toggleClass("cm-preview-code-block",s),r.childrenEl.toggleClass("is-rendered",s)}),this.renderMarkdownButtonEl.toggleClass("is-active",s)},l.onCopyResultsClick=s=>b(this,null,function*(){var i,o;s.stopPropagation(),s.preventDefault();let n=[],r=[e.backlinkDom,e.unlinkedDom];for(let c of r){let p=(i=c.vChildren)==null?void 0:i._children;for(let u of p){let y=u.file.path,x="",k=(o=u.vChildren)==null?void 0:o._children;for(let v of k){let E=v.parent.content.substring(v.start,v.end);x+=E+`
`}n.push(`## ${y}
${x}`)}}let a=n.join(`
`);try{yield navigator.clipboard.writeText(a)}catch(c){console.error("Failed to copy backlinks:",c),new g.Notice("Failed to copy backlinks.")}}),l.renderMarkdownButtonEl=e.headerDom.addNavButton("reading-glasses","Render Markdown",s=>(s.stopPropagation(),l.setRenderMarkdown(!l.renderMarkdown))),e.headerDom.addNavButton("documents","Copy results",l.onCopyResultsClick.bind(l));let t={title:h.settings.defaultHideResults,collapsed:h.settings.defaultCollapse,context:h.settings.defaultShowContext,hideTitle:h.settings.defaultHideTitle,hideResults:h.settings.defaultHideResults,renderMarkdown:h.settings.defaultRenderMarkdown,sort:h.settings.defaultSortOrder};l.settings||(l.settings={}),Object.entries(t).forEach(([s,n])=>{l.settings.hasOwnProperty(s)?s==="sort"&&!O.hasOwnProperty(l.settings.sort)&&(l.settings[s]=n):l.settings[s]=n}),e.setExtraContext(l.settings.context),e.sortOrder=l.settings.sort,e.setCollapseAll(l.settings.collapsed),l.setRenderMarkdown(l.settings.renderMarkdown)}}
